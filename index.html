<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird Clone</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
      margin: auto;
      touch-action: none;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Fullscreen canvas
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Load images
    const bg = new Image();
    const bird = new Image();
    const fg = new Image();
    const pipeNorth = new Image();
    const pipeSouth = new Image();

    bg.src = "bg.png";
    bird.src = "bird.png";
    fg.src = "fg.png";
    pipeNorth.src = "pipeNorth.png";
    pipeSouth.src = "pipeSouth.png";

    // Bird
    let bX = 50;
    let bY = 150;
    let gravity = 1.5;
    let lift = -25;
    let velocity = 0;

    // Pipes
    let pipes = [];
    let pipeGap = 140;
    let pipeSpeed = 2;

    // Score
    let score = 0;
    let gameOver = false;

    // Controls
    function flap() {
      if (!gameOver) {
        velocity = lift;
      } else {
        location.reload(); // restart game
      }
    }

    document.addEventListener("keydown", flap);
    canvas.addEventListener("touchstart", flap);

    // Pipe generator
    pipes[0] = {
      x: canvas.width,
      y: 0
    };

    function draw() {
      // Draw background
      ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

      for (let i = 0; i < pipes.length; i++) {
        let constant = pipeNorth.height + pipeGap;

        // Draw pipes
        function drawPipes() {
  for (let i = 0; i < pipes.length; i++) {
    let constant = pipeNorth.height + pipeGap;

    // gambar pipa atas
    ctx.drawImage(pipeNorth, pipes[i].x, pipes[i].y);

    // gambar pipa bawah
    ctx.drawImage(pipeSouth, pipes[i].x, pipes[i].y + constant);

    // gerakin pipa
    pipes[i].x -= pipeSpeed;

    // tambah pipa baru
    if (pipes[i].x === canvas.width / 2) {
      pipes.push({
        x: canvas.width,
        y: Math.floor(Math.random() * pipeNorth.height) - pipeNorth.height
      });
    }

    // deteksi tabrakan
    if (
      bX + bird.width >= pipes[i].x &&
      bX <= pipes[i].x + pipeNorth.width &&
      (bY <= pipes[i].y + pipeNorth.height ||
        bY + bird.height >= pipes[i].y + constant) ||
      bY + bird.height >= canvas.height - fg.height
    ) {
      gameOver = true;
    }

    // tambah skor
    if (pipes[i].x === 5) {
      score++;
    }
  }
        }

        // Move pipe
        pipes[i].x -= pipeSpeed;

        if (pipes[i].x === canvas.width / 2) {
          pipes.push({
            x: canvas.width,
            y: Math.floor(Math.random() * pipeNorth.height) - pipeNorth.height
          });
        }

        // Collision detection
        if (
          bX + bird.width >= pipes[i].x &&
          bX <= pipes[i].x + pipeNorth.width &&
          (bY <= pipes[i].y + pipeNorth.height ||
            bY + bird.height >= pipes[i].y + constant) ||
          bY + bird.height >= canvas.height - fg.height
        ) {
          gameOver = true;
        }

        if (pipes[i].x === 5) {
          score++;
        }
      }

      // Draw foreground
      ctx.drawImage(fg, 0, canvas.height - fg.height, canvas.width, fg.height);

      // Draw bird
      ctx.drawImage(bird, bX, bY);

      velocity += gravity;
      bY += velocity;

      // Draw score
      ctx.fillStyle = "#fff";
      ctx.font = "30px Arial";
      ctx.fillText("Score : " + score, 10, canvas.height - 20);

      if (!gameOver) {
        requestAnimationFrame(draw);
      } else {
        ctx.fillStyle = "red";
        ctx.font = "50px Arial";
        ctx.fillText("Game Over", canvas.width / 2 - 150, canvas.height / 2);
        ctx.font = "24px Arial";
        ctx.fillText("Tap layar / tekan tombol untuk restart", canvas.width / 2 - 200, canvas.height / 2 + 40);
      }
    }

    draw();

    // Resize handler
    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
  </script>
</body>
</html>
